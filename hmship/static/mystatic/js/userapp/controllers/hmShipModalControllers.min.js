var hmShipModalControllers=angular.module("hmShipModalControllers",[]);
hmShipModalControllers.controller("changePwdModalController",function($scope,$uibModalInstance,$location,$http,userSessionServices){$scope.showSuccessMessage=false;$scope.errors={};$scope.changePwdPut=function(){if($scope.changePwdForm.$valid){data={"old_password":$scope.oldPwd,"new_password":$scope.newPwd1,"new_password_confirm":$scope.newPwd2};$http.put("api/changepassword/",data).success(function(successResponse){if(successResponse=="Success")$scope.showSuccessMessage=true}).error(function(errorResponse){$scope.errors=
errorResponse})}};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});hmShipModalControllers.controller("regThanksModalController",function($scope,$uibModalInstance,$location){var $ctrl=this;$scope.close=function(){$uibModalInstance.close($location.path("/home"))}});
hmShipModalControllers.controller("inspectionInfoModalController",function($scope,$uibModalInstance,inspection_type_info,$sce){$scope.inspection_type_info=inspection_type_info;console.log($scope.inspection_type_info);$scope.popover_html="/static/templates/userapp/partials/popover/inspection_rating.html";$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("inspectionModalController",function($scope,$uibModalInstance,inspection){$scope.inspection=inspection.data;console.log($scope.inspection);$scope.popover_html="/static/templates/userapp/partials/popover/inspection_rating.html";$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});hmShipModalControllers.controller("productPicturePreviewController",function($scope,$uibModalInstance,mobilePhoto){$scope.mobilePhoto=mobilePhoto;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("purchaseModifyController",function($scope,$uibModalInstance,purchaseInfo,auctionList,Upload,$uibModal,$http){$scope.uploadFields={};$scope.uploadFields=purchaseInfo;$scope.uploadFields.auctionName=String(purchaseInfo.auction.id);$scope.auctionList=auctionList;Upload.urlToBlob(purchaseInfo.image1).then(function(blob){$scope.uploadFields.mobilePhoto=blob;$scope.selectedFile=blob});$scope.select=function(event,file){$scope.selectedFile=file};$scope.picPreview=function(size,
file){var modalInstance=$uibModal.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",animation:$scope.animationsEnabled,templateUrl:"/static/templates/userapp/partials/productPicturepreview.html",controller:"productPicturePreviewController",size:"md",resolve:{mobilePhoto:function(){return file}}})};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")};$scope.uploadProduct=function(){var file=$scope.selectedFile;if($scope.uploadProductForm.$valid){$scope.f=file;file.upload=Upload.upload({url:"api/editproducts/"+
String($scope.uploadFields.id)+"/",method:"PUT",data:{auction:$scope.uploadFields.auctionName,lot_number:$scope.uploadFields.lot_number,image1:file,description:$scope.uploadFields.description,item_name:$scope.uploadFields.item_name}});file.upload.then(function(response){$scope.uploadFields={};$scope.uploadProductForm.$setUntouched();$scope.uploadProductForm.$setPristine();$scope.showSuccessMessage=true;$scope.selectedFile=undefined;alert("Product Succesfully Uploaded");$uibModalInstance.dismiss("cancel")},
function(response){$scope.errorMsg=response.status+": "+response.data;$scope.showSuccessMessage=false},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})}}});hmShipModalControllers.controller("purchaseDetailsController",function($scope,$uibModalInstance,item){$scope.item=item;$scope.services=function(obj){var services_list=[];if(obj.logistics)services_list.push("Logistics");if(obj.maintenance)services_list.push("Maintenance");return services_list};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("paymentDetailsController",function($scope,$uibModalInstance,row){$scope.row=row;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});hmShipModalControllers.controller("orderBookDetailsController",function($scope,$uibModalInstance,order){$scope.order=order;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("registerPaymentModalController",function($scope,$uibModalInstance,bank,total,Upload,$location){$scope.bank=bank;$scope.total=total;function cartServiceIds(shoppingCart){var service_list=[];for(var i in shoppingCart)service_list.push(shoppingCart[i].id);return service_list}$scope.reisterBankDeposit=function(file){if($scope.registerBankDepositForm.$valid){$scope.f=file;file.upload=Upload.upload({url:"api/payments/",data:{payment_type:"deposit",services_set:JSON.stringify(JSON.parse(sessionStorage.getItem("shoppingCart"))),
proof:file}});file.upload.then(function(response,status){if(response.status==200)$uibModalInstance.close(sessionStorage.setItem("shoppingCart","[]"),alert("Payment Succesfully Registered! We will let you know when the payment has been credited"),$location.path("paymenthistory"))},function(response){if(response.status>0)$scope.errorMsg=response.status+": "+response.data;$scope.showSuccessMessage=false},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})}};$scope.select=function(event,
file){$scope.selectedFile=file};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});hmShipModalControllers.controller("serviceDetailsModalController",function($scope,$uibModalInstance,service){$scope.service=service;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});hmShipModalControllers.controller("pendingQuoteModalController",function($scope,$uibModalInstance,message){$scope.message=message;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("quoteController",function($scope,$uibModalInstance,service,$http){$scope.hide_modal=false;$scope.service=service;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")};$scope.respondToQuote=function(quote_approved){var fill;if(quote_approved)fill="accept";else fill="reject";confirmation=confirm("Are you sure you wish to "+fill+" this quote?");if(!confirmation)return false;$scope.hide_modal=true;var url="api/services/"+$scope.service.id+"/";var params={};params.quote_approved=
quote_approved;$http.patch(url,params).success(function(service){$uibModalInstance.close(service)}).error(function(errors){console.log(errors)})}});hmShipModalControllers.controller("auctionDetailsModalController",function($scope,$uibModalInstance,auctionDetails){$scope.auctionDetails=auctionDetails;$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});
hmShipModalControllers.controller("requestEmailModalController",function($scope,$uibModalInstance,$http,$window,userSessionServices){$scope.cancel=function(){$uibModalInstance.dismiss("cancel")};$scope.resetValidator=function(){$scope.error=""};$scope.registerEmailPost=function(){if($scope.registerEmail.$valid){var userProfile=$window.sessionStorage.getItem("userDataString");var url="api/users/"+userProfile.id+"/";var data={};data.email=$scope.email;data.email_confirm=$scope.emailConfirm;$http.patch(url,
data).success(function(response,status){if(status==200){userSessionServices.updateSessionStorage(response);$uibModalInstance.close(alert("Email succesfully registered"))}}).error(function(errors,status){$scope.error=errors.email[0]})}}});