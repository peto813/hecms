var hmShipServices=angular.module("hmShipServices",[]);hmShipServices.factory("auctionDataService",["$http","$q",function($http,$q){return{getAutionList:function(){var url="api/auctions/";return $http({method:"GET",url:url})}}}]);hmShipServices.factory("googleMapsApiService",["$http","$q",function($http,$q){return{getAutionList:function(){var url="api/auctions/";return $http({method:"GET",url:url})}}}]);
hmShipServices.factory("socialAppService",function($q,$http,$window){return{getFbToken:function(){var deferred=$q.defer();FB.login(function(FbResponse){if(FbResponse.status=="connected"){var FbData={"access_token":FbResponse.authResponse.accessToken};$http.post("rest-auth/facebook/",FbData).success(function(DRFResponse){$window.sessionStorage.setItem("token",DRFResponse.key);deferred.resolve("Success")}).error(function(DRFError){deferred.reject(DRFError)})}},{scope:"email",return_scopes:true});return deferred.promise},
getGoogleToken:function(){var deferred=$q.defer();GoogleAuth=gapi.auth2.getAuthInstance();GoogleAuth.signIn().then(function(googleResponse){var googleData={"access_token":googleResponse.Zi.access_token};$http.post("rest-auth/google/",googleData).success(function(DRFResponse){$window.sessionStorage.setItem("token",DRFResponse.key);deferred.resolve("Success")}).error(function(DRFError){deferred.reject(DRFError)})});return deferred.promise}}});
hmShipServices.factory("yearListService",function($window,$q){return{request:function(){var user_string=$window.sessionStorage.getItem("userDataString");var yearList=[];if(user_string){var year_joined=(new Date(JSON.parse(user_string).date_joined)).getFullYear();var this_year=(new Date).getFullYear();do{yearList.push(year_joined);year_joined++}while(year_joined<=this_year);return yearList}return yearList}}});
hmShipServices.factory("tokenAuthInterceptor",function($window,$q){return{request:function(config){config.headers=config.headers||{};if($window.sessionStorage.getItem("token"))config.headers.Authorization="Token "+$window.sessionStorage.getItem("token");return config||$q.when(config)},response:function(response){if(response.status===401);return response||$q.when(response)}}});
hmShipServices.factory("userSessionServices",["$http","$window","$location","$q",function($http,$window,$location,$q){var errors={};var _identity=undefined,_authenticated=false;return{logIn:function(credentials){var deferred=$q.defer();var url="rest-auth/login/";$http.post(url,credentials).success(function(token){if(token!=null){deferred.resolve(token.key);$window.sessionStorage.setItem("shoppingCart","[]");$window.sessionStorage.setItem("token",token.key)}else deferred.reject("email/password error")}).error(function(error){if(error!=
null){for(var field in error)if(field==="non_field_errors")errors[field]=error[field].join(", ");deferred.reject(errors)}});return deferred.promise},logOut:function(){var url="/rest-auth/logout/";$http({method:"POST",url:url}).then(function(response){if(response.status==200){$window.sessionStorage.clear();$location.path("/")}},function errorCallback(response){console.log(JSON.stringify(response))})},isAuthenticated:function(){var token=sessionStorage.getItem("token");return token?true:false},updateSessionStorage:function(newUserDataObj){sessionStorage.setItem("userDataString",
JSON.stringify(newUserDataObj));return"success"},userProfile:function(){var deferred=$q.defer();var userDataString=sessionStorage.getItem("userDataString");if(userDataString)deferred.resolve(JSON.parse(userDataString));else{var url=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/api/users/";$http({method:"GET",url:url}).then(function successCallback(response){deferred.resolve(response.data[0])},function errorCallback(error){deferred.resolve(error)});return deferred.promise}}}}]);